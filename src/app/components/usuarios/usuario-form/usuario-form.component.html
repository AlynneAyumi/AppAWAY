<div class="usuario-form-container">
  <div class="page-header">
    <div class="header-content">
      <h1>{{ isEdit ? 'Editar Usuário' : 'Novo Usuário' }}</h1>
      <p>{{ isEdit ? 'Atualize as informações do usuário' : 'Preencha os dados para criar um novo usuário' }}</p>
    </div>
    <button class="btn btn-secondary" (click)="voltar()">
      <i class="fas fa-arrow-left"></i>
      Voltar
    </button>
  </div>

  @if (loading) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Carregando usuário...</p>
    </div>
  } @else {
    <form class="usuario-form" (ngSubmit)="salvar()">
      <div class="form-sections">
        <!-- Dados do Usuário -->
        <div class="form-section">
          <h3><i class="fas fa-user"></i> Dados do Usuário</h3>
          
          <!-- Alerta importante sobre campos obrigatórios -->
          <div class="alert alert-warning" role="alert">
            <i class="fas fa-exclamation-triangle"></i>
            <strong>Atenção:</strong> Todos os campos marcados com * são obrigatórios.
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="nome">Nome Completo *</label>
              <input
                type="text"
                id="nome"
                [(ngModel)]="usuario.nome"
                name="nome"
                class="form-control"
                placeholder="Digite o nome completo"
                required
              />
            </div>
            <div class="form-group">
              <label for="segundoNome">Segundo Nome *</label>
              <input
                type="text"
                id="segundoNome"
                [(ngModel)]="usuario.pessoa!.segundoNome"
                name="segundoNome"
                class="form-control"
                placeholder="Digite o segundo nome"
                required
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="nomeUser">Nome de Usuário *</label>
              <input
                type="text"
                id="nomeUser"
                [(ngModel)]="usuario.nomeUser"
                name="nomeUser"
                class="form-control"
                placeholder="Digite o nome de usuário"
                required
              />
            </div>
            <div class="form-group">
              <label for="email">E-mail *</label>
              <input
                type="email"
                id="email"
                [(ngModel)]="usuario.email"
                name="email"
                class="form-control"
                placeholder="Digite o e-mail"
                required
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="senha">Senha {{ isEdit ? '(deixe em branco para manter a atual)' : '*' }}</label>
              <input
                type="password"
                id="senha"
                [(ngModel)]="usuario.senha"
                name="senha"
                class="form-control"
                placeholder="Digite a senha"
                [required]="!isEdit"
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="perfil">Perfil *</label>
              <select
                id="perfil"
                [(ngModel)]="usuario.perfil"
                name="perfil"
                class="form-control"
                required
              >
                @for (perfil of perfilOptions; track perfil) {
                  <option [value]="perfil">{{ getPerfilText(perfil) }}</option>
                }
              </select>
            </div>
            <div class="form-group">
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  [(ngModel)]="usuario.ativo"
                  name="ativo"
                />
                <span class="checkbox-custom"></span>
                Usuário ativo
              </label>
            </div>
          </div>
        </div>

        <!-- Dados Pessoais -->
        <div class="form-section">
          <h3><i class="fas fa-id-card"></i> Dados Pessoais</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="cpf">CPF *</label>
              <input
                type="text"
                id="cpf"
                [(ngModel)]="usuario.pessoa!.cpf"
                name="cpf"
                class="form-control"
                placeholder="000.000.000-00"
                required
              />
            </div>
            <div class="form-group">
              <label for="telefone">Telefone *</label>
              <input
                type="text"
                id="telefone"
                [(ngModel)]="usuario.pessoa!.telefone"
                name="telefone"
                class="form-control"
                placeholder="(00) 00000-0000"
                required
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="dataNascimento">Data de Nascimento</label>
              <input
                type="date"
                id="dataNascimento"
                [(ngModel)]="usuario.pessoa!.dataNascimento"
                name="dataNascimento"
                class="form-control"
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="emailPessoa">E-mail da Pessoa</label>
              <input
                type="email"
                id="emailPessoa"
                [(ngModel)]="usuario.pessoa!.email"
                name="emailPessoa"
                class="form-control"
                placeholder="Digite o e-mail da pessoa"
              />
            </div>
          </div>
        </div>

        <!-- Endereço -->
        <div class="form-section">
          <h3><i class="fas fa-map-marker-alt"></i> Endereço</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="cep">CEP</label>
              <input
                type="text"
                id="cep"
                [(ngModel)]="usuario.pessoa!.endereco!.cep"
                name="cep"
                class="form-control"
                placeholder="00000-000"
              />
            </div>
            <div class="form-group">
              <label for="logradouro">Logradouro</label>
              <input
                type="text"
                id="logradouro"
                [(ngModel)]="usuario.pessoa!.endereco!.logradouro"
                name="logradouro"
                class="form-control"
                placeholder="Rua, Avenida, etc."
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="numero">Número</label>
              <input
                type="text"
                id="numero"
                [(ngModel)]="usuario.pessoa!.endereco!.numero"
                name="numero"
                class="form-control"
                placeholder="123"
              />
            </div>
            <div class="form-group">
              <label for="bairro">Bairro</label>
              <input
                type="text"
                id="bairro"
                [(ngModel)]="usuario.pessoa!.endereco!.bairro"
                name="bairro"
                class="form-control"
                placeholder="Nome do bairro"
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="cidade">Cidade</label>
              <input
                type="text"
                id="cidade"
                [(ngModel)]="usuario.pessoa!.endereco!.cidade"
                name="cidade"
                class="form-control"
                placeholder="Nome da cidade"
              />
            </div>
            <div class="form-group">
              <label for="estado">Estado</label>
              <input
                type="text"
                id="estado"
                [(ngModel)]="usuario.pessoa!.endereco!.estado"
                name="estado"
                class="form-control"
                placeholder="UF"
                maxlength="2"
              />
            </div>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="voltar()">
          <i class="fas fa-times"></i>
          Cancelar
        </button>
        <button 
          type="submit" 
          class="btn btn-primary" 
          [disabled]="salvando"
        >
          @if (salvando) {
            <i class="fas fa-spinner fa-spin"></i>
            {{ isEdit ? 'Atualizando...' : 'Criando...' }}
          } @else {
            <i class="fas fa-save"></i>
            {{ isEdit ? 'Atualizar Usuário' : 'Criar Usuário' }}
          }
        </button>
      </div>
    </form>
  }
</div>
