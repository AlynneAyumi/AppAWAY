<div class="dashboard-container">
  <div class="dashboard-header">
    <div class="header-content">
      <div class="header-text">
        <h1>Dashboard</h1>
        <p>Visão geral do sistema de gestão do patronato</p>
      </div>
      <button class="btn btn-outline-primary btn-sm refresh-btn" (click)="carregarEstatisticas()" [disabled]="loading">
        <i class="fas fa-sync-alt" [class.fa-spin]="loading"></i>
        {{ loading ? 'Carregando...' : 'Recarregar Dados' }}
      </button>
    </div>
  </div>

  @if (loading) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Carregando estatísticas...</p>
    </div>
  } @else {
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon total">
          <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
          <h3>{{ stats.totalAssistidos }}</h3>
          <p>Total de Assistidos</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon active">
          <i class="fas fa-user-check"></i>
        </div>
        <div class="stat-content">
          <h3>{{ stats.assistidosAtivos }}</h3>
          <p>Assistidos Ativos</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon comparecimentos">
          <i class="fas fa-calendar-check"></i>
        </div>
        <div class="stat-content">
          <h3>{{ stats.comparecimentosHoje }}</h3>
          <p>Comparecimentos Hoje</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon pendentes">
          <i class="fas fa-clock"></i>
        </div>
        <div class="stat-content">
          <h3>{{ stats.comparecimentosPendentes }}</h3>
          <p>Comparecimentos Pendentes</p>
        </div>
      </div>
    </div>

    <div class="dashboard-content">
      <div class="content-grid">
        <div class="content-card">
          <div class="card-header">
            <h3>Atividades Recentes</h3>
            @if (atividadesRecentes.length > 0) {
              <button class="btn btn-outline-primary btn-sm expand-btn" (click)="alternarAtividades()">
                <i class="fas" [class.fa-chevron-down]="!atividadesExpandidas" [class.fa-chevron-up]="atividadesExpandidas"></i>
                {{ atividadesExpandidas ? 'Ver Menos' : 'Ver Todas' }}
              </button>
            }
          </div>
          <div class="card-content">
            @if (atividadesRecentes.length > 0) {
              @for (atividade of getAtividadesVisiveis(); track atividade.id) {
                <div class="activity-item">
                  <div class="activity-icon">
                    @if (atividade.tipo === 'cadastro') {
                      <i class="fas fa-user-plus"></i>
                    } @else if (atividade.tipo === 'comparecimento') {
                      <i class="fas fa-calendar-check"></i>
                    } @else {
                      <i class="fas fa-times-circle"></i>
                    }
                  </div>
                  <div class="activity-text">
                    <p>{{ atividade.descricao }}</p>
                    @if (atividade.assistido) {
                      <p class="assistido-nome">{{ atividade.assistido }}</p>
                    }
                    <span>{{ formatarTempoRelativo(atividade.data) }}</span>
                  </div>
                </div>
              }
            } @else {
              <div class="no-data">
                <p>Nenhuma atividade recente encontrada</p>
              </div>
            }
          </div>
        </div>

        <div class="content-card">
          <div class="card-header">
            <h3>Próximos Comparecimentos</h3>
            @if (proximosComparecimentos.length > 0) {
              <button class="btn btn-outline-primary btn-sm expand-btn" (click)="alternarComparecimentos()">
                <i class="fas" [class.fa-chevron-down]="!comparecimentosExpandidos" [class.fa-chevron-up]="comparecimentosExpandidos"></i>
                {{ comparecimentosExpandidos ? 'Ver Menos' : 'Ver Todos' }}
              </button>
            }
          </div>
          <div class="card-content">
            @if (proximosComparecimentos.length > 0) {
              @for (comparecimento of getComparecimentosVisiveis(); track comparecimento.id) {
                <div class="appointment-item">
                  <div class="appointment-time">
                    <span class="time">{{ comparecimento.horario }}</span>
                    <span class="date">{{ comparecimento.data }}</span>
                  </div>
                  <div class="appointment-details">
                    <p>{{ comparecimento.assistido }}</p>
                    <span class="status" [class.confirmed]="comparecimento.status === 'compareceu'" 
                          [class.pending]="comparecimento.status === 'pendente'">
                      {{ comparecimento.status === 'compareceu' ? 'Compareceu' : 'Pendente' }}
                    </span>
                  </div>
                </div>
              }
            } @else {
              <div class="no-data">
                <p>Nenhum comparecimento agendado</p>
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  }
</div>